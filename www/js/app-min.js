function handleOpenURL(e){window.cordova.fireDocumentEvent("handleopenurl",{url:e})}function mapsProvider(e){e.configure({key:"AIzaSyAwK51ikb7PENrz_eEBJ8mC1hwxsLWbDDQ",libraries:"places"})}function authProvider(e,t){e.authHeader="Authorization",e.authToken="Bearer",e.token="token",e.tokenPrefix="access",e.storageType="localStorage",e.facebook({clientId:"1665816233706214",name:"facebook",url:"http://159.203.47.252:1338/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:window.location.origin+"/",requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",type:"2.0",popupOptions:{width:580,height:400}}),e.google({url:"http://159.203.47.252:1338/auth/google",clientId:"1081734392317-3gh14vephi624rc7esoikas0p9coeukj.apps.googleusercontent.com",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:window.location.origin,requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",type:"2.0",popupOptions:{width:452,height:633}}),t.interceptors.push("interceptorsService")}window.cordova&&window.cordova.addStickyDocumentEventHandler("handleopenurl"),window.io&&(window.io.sails.autoConnect=!1),angular.module("adbionic",["ionic","ngCordova","uiGmapgoogle-maps","satellizer"]),angular.module("adbionic").constant("BaseApiUrl","http://159.203.47.252:1338").constant("version","1").constant("_",window._).constant("moment",window.moment).constant("io",window.io),angular.module("adbionic").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("app",{url:"/app","abstract":!0,templateUrl:"templates/tabs.html",controller:"AppCtrl",authenticate:!1}).state("app.dashboard",{url:"/dashboard",views:{dashboard:{templateUrl:"templates/dashboard.html",controller:"DashboardCtrl"}},authenticate:!0}).state("app.buddies",{url:"/buddies",views:{buddies:{templateUrl:"templates/buddies.html",controller:"BuddiesCtrl"}},authenticate:!0}).state("app.search",{url:"/search",views:{search:{templateUrl:"templates/search.html",controller:"SearchCtrl"}},authenticate:!0}).state("app.notifications",{url:"/notifications",views:{notifications:{templateUrl:"templates/notifications.html",controller:"NotificationsCtrl"}},authenticate:!0}).state("app.chats",{url:"/chats",views:{chats:{templateUrl:"templates/chats.html",controller:"ChatsCtrl"}},authenticate:!0}).state("home",{url:"/home",templateUrl:"templates/home.html",controller:"HomeCtrl",authenticate:!1}).state("signup",{url:"/signup",templateUrl:"templates/signup.html",controller:"SignUpCtrl",authenticate:!1}).state("completesignup",{url:"/completesignup",templateUrl:"templates/completesignup.html",controller:"SignUpCtrl",authenticate:!0}).state("login",{url:"/login",templateUrl:"templates/login.html",controller:"LoginCtrl",authenticate:!1}),t.otherwise("/home")}]),angular.module("adbionic").run(["$rootScope","$ionicPlatform","$cordovaKeyboard","$cordovaStatusbar","$state","$ionicHistory","LocalService","Auth","SocketService",function(e,t,n,i,a,o,r,c,s){t.ready(function(){window.cordova&&(n.hideAccessoryBar(!0),n.disableScroll(!0),i.style(0))}),e.$on("$stateChangeSuccess",function(t,n){var i=["login","resetPassword"];return e.currentState=n.name,e.isAuthenticated=c.isAuthenticated(),c.isAuthenticated()&&(e.isAuthenticated=!0,e.user=JSON.parse(r.get("user"))),"validate"==n.name&&c.isAuthenticated()?void(e.view="main"):"validate"!=n.name||c.isAuthenticated()?(!n.authenticate&&c.isAuthenticated()&&e.user.completedSignup&&(console.log("authenticated"),t.preventDefault(),a.transitionTo("app.dashboard"),e.currentState="app.dashboard"),n.authenticate&&!c.isAuthenticated()&&(console.log("not auth"),t.preventDefault(),r.unset("user"),a.transitionTo("login"),e.currentState="login"),void(e.view=i.indexOf(e.currentState)>=0?"auth":"main")):void(e.view="auth")})}]),angular.module("adbionic").config(mapsProvider).config(authProvider),mapsProvider.$inject=["uiGmapGoogleMapApiProvider"],authProvider.$inject=["$authProvider","$httpProvider"],function(){"use strict";function e(){var e={restrict:"EA",controller:t,templateUrl:"js/directives/adbMessageActivity.html",scope:{pattern:"=adbMessageActivity"}};return e}function t(e,t,n,i){function a(){console.log(t.pattern),t.loading=!0,t.activityId=o(),i.getDetail(t.activityId).then(function(e){t.activity=e.activity,t.activity.participants=e.participants,t.loading=!1,r()})}function o(){var e=t.pattern.split("[search:");return e[e.length-1].slice(0,-1)}function r(){for(var e=t.activity.participants.length-1;e>=0;e--){var i=t.activity.participants[e];t.activity.participants[e].fullname=i.user?i.user.fullname:"",t.activity.participants[e].profileImage=i.user?i.user.profileImage:"",t.activity.status=t.activity.participants[e].status,i.user&&i.user.id==n.user.id&&"requested"==t.activity.participants[e].status?t.showInvitation=!0:t.showInvitation=!1}}function c(e){i.setUpdate(e)}a(),t.openSearch=function(){c(t.activity)}}angular.module("adbionic").directive("adbMessageActivity",e)}(),function(){"use strict";angular.module("adbionic").directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ngEnter)}),t.preventDefault())})}})}(),function(){"use strict";function e(){function e(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}return e}angular.module("adbionic").filter("capitalize",e)}(),function(){"use strict";function e(e){function t(t){return e.isEmpty(t)}return t}angular.module("adbionic").filter("empty",e),e.$inject=["_"]}(),function(){"use strict";function e(){function e(e){return e.match(/^\[search:[a-zA-Z0-9_]*\]/gi)}return e}angular.module("adbionic").filter("isActivity",e)}(),function(){"use strict";function e(){function e(e){return Object.keys(e)}return e}angular.module("adbionic").filter("keys",e)}(),function(){"use strict";function e(e){function t(t){return e.isArray(t)?t[t.length-1]:{}}return t}angular.module("adbionic").filter("lastItem",e),e.$inject=["_"]}(),function(){"use strict";function e(e){function t(t){return n(t)?"Photo":e(t)?"Activity":t}function n(e){var t=/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/;return t.test(e)}return t}angular.module("adbionic").filter("message",e),e.$inject=["isActivityFilter"]}(),function(){"use strict";function e(e){function t(t){return-1!=e.find(t)}return t}angular.module("adbionic").filter("myBuddy",e),e.$inject=["FriendshipService"]}(),function(){"use strict";function e(){function e(e,t,n){function i(e){return!isNaN(parseFloat(e))&&isFinite(e)}function a(e,t){return e[t]}var o=[];return angular.forEach(e,function(e,t){e.key=t,o.push(e)}),o.sort(function(e,n){var o,r=t.split(".").reduce(a,e),c=t.split(".").reduce(a,n);return i(r)&&i(c)&&(r=Number(r),c=Number(c)),o=r===c?0:r>c?1:-1}),n&&o.reverse(),o}return e}angular.module("adbionic").filter("objectOrder",e)}(),function(){"use strict";function e(e){function t(e){for(var t=[],n=e.length-1;n>=0;--n)e[n].hasOwnProperty("messages")&&e[n].messages.length&&"read"!=e[n].messages[e[n].messages.length-1].status&&t.push(e[n]);return t}return t}angular.module("adbionic").filter("unread",e),e.$inject=["$rootScope"]}(),angular.module("adbionic").controller("AppCtrl",["$scope","$state","$rootScope","$ionicModal","$ionicPlatform","$timeout","$ionicPopover","SocketService","Auth","UtilService","NotificationService","ActivityService","ConversationsService","FriendshipService","UserService",function(e,t,n,i,a,o,r,c,s,u,d,l,f,m,p){function g(){e.user=n.user,c.init(),d.get().then(function(e){},function(e){console.log(e)}),u.getBadWords(),c.connection.on("user",function(t){var n=(t.data.verb,t.data.model),i=t.data.payload;console.log(n,i),e.$apply(function(){switch(!0){case"notification"===n:i.isInvitation&&d.list.push(i),i.action||"function"!=typeof e[i.handler]||e[i.handler](),"RelationshipCreatedAndAccepted"===i.type&&(f.state(i.relatedRoom,"isDisabled",!1),f.state(i.relatedRoom,"_isHide",!1));break;case"room"===n:f.push(i);break;case"user"===n:var a=m.find(i.id);a>=0&&m.changeStatus(a,i.isOnline);break;case"relationship"===n:m.removeLocalByRelationship(i.relationship),i.room&&f.state(i.room,"isDisabled",!0);break;default:console.log(t.data)}})}),y(),e.resendVerification=function(){e.loadingVerification=!0,p.resendVerification().then(function(t){e.loadingVerification=!1})},f.init()["finally"](function(){e.loading=!1})}function v(t){for(var i=0,a=t.length-1;a>=0;--a)t[a].hasOwnProperty("messages")&&t[a].messages.length&&"read"!=t[a].messages[t[a].messages.length-1].status&&t[a].messages[t[a].messages.length-1].creator.id!=n.user.id&&i++;e.unread=i}function h(t){e.loadingCategories=!0,l.getCategories(t).then(function(t){e.categories=t.subcategories})["finally"](function(){e.loadingCategories=!1})}function y(){e.loading_buddies=!0,m.getMyBuddies()["finally"](function(){e.loading_buddies=!1})}function b(t){p.buddies(t).then(function(t){e.selected_buddy.friends=t})}function _(t){e.loading_activities=!0,p.activities(t).then(function(t){e.selected_buddy.activities=t})["finally"](function(){e.loading_activities=!1})}console.log("App"),e.buddies=m.buddies,e.notifications=d.list,e.conversations=f.conversations,e.activity={},e.step=1,e.filter="",e.config={};var S="DD/MM/YYYY hh:mm a",w="#datetimepicker-start",M="#datetimepicker-end";e.data={},e.selected_buddy={},e.selected_group={},e.new_members=[],e.default_avatar=u.defaultAvatar,g(),e.$watch("conversations",function(e,t){e&&v(e)},!0),e.logout=function(){console.log("LogOut"),e.popover.hide(),c.request("GET","/user/unsubscribe/",null,function(e,t){c.connection.disconnect(),c.subscribed=!1,s.logout()})},e.dashboard=function(){t.go("dashboard",{},{reload:!0})},e.openModalSettings=function(){i.fromTemplateUrl("templates/modal/profileSettings.html",{scope:e}).then(function(t){e.modal_settings=t,e.popover.hide(),e.modal_settings.show()})},e.hideModalSettings=function(){e.modal_settings.remove()},e.openModalSearch=function(t){i.fromTemplateUrl("templates/modal/searchDetail.html",{scope:e}).then(function(n){e.modal_search=n,e.activity=angular.copy(t),e.participants=angular.copy(t.participants),e.modal_search.show()})},e.hideModalSearch=function(){e.activity={},e.participants=[],e.buddies.map(function(e){delete e.invited}),e.modal_search.remove()},e.openModalNewSearch=function(t,n){i.fromTemplateUrl("templates/modal/newSearch.html",{scope:e}).then(function(i){e.modal_newsearch=i,e.isFromChat=!!n,h(),t&&(e.new_search=angular.copy(t)),e.modal_newsearch.show()})},e.hideModalNewSearch=function(){e.step=1,e.new_search={vibe:!0,category:"social",activities:[],type:"public",participants:[]},e.modal_newsearch.remove()},e.openSearchFindModal=function(t,n,a){i.fromTemplateUrl("templates/modal/searchModal.html",{scope:e}).then(function(i){if(e.modal_findsearch=i,e.new_search=a,e.config.action=t,e.config.placeholder=n,"When"==t){e.modal_findsearch.show();var o={format:S,inline:!0,sideBySide:!0,icons:{up:"ion-chevron-up",down:"ion-chevron-down",previous:"ion-chevron-left",next:"ion-chevron-right"}};e.startDate||(e.startDate=moment().format(S)),e.endDate||(e.endDate=moment().add(1,"hour").format(S)),-1==e.endDate&&(e.endDate="Until Further Notice"),$(w).datetimepicker(o),$(M).datetimepicker(o),$(w).on("dp.change",function(t){e.$apply(function(){var t=$(w).data("DateTimePicker").date(),n=$(M).data("DateTimePicker").date();e.startDate=$(w).data("DateTimePicker").date().format(S),n.isBefore(t)&&(e.endDate=t.format(S),$(M).data("DateTimePicker").date(t))})}),$(M).on("dp.change",function(t){var n=$(M).data("DateTimePicker").date(),i=$(w).data("DateTimePicker").date();n.isBefore(i)?(e.endDate=i.format(S),$(M).data("DateTimePicker").date(i)):e.endDate=$(M).data("DateTimePicker").date().format(S)})}})},e.okSearchFindModal=function(){e.modal_findsearch.remove()},r.fromTemplateUrl("templates/modal/popoverProfile.html",{scope:e}).then(function(t){e.popover=t}),e.openPopover=function(t){e.popover.show(t)},e.openModalProfile=function(t,n){i.fromTemplateUrl("templates/modal/buddyProfile.html",{scope:e}).then(function(i){e.modal_profile=i,e.popover.hide(),e.logged=!!n,t?(e.selected_buddy=angular.copy(t),b(e.selected_buddy.id),_(e.selected_buddy.id),e["new"]=!1):e["new"]=!0,e.modal_profile.show()})},e.hideModalProfile=function(){e.selected_buddy={},e.modal_profile.remove()},e.openModalGroup=function(t){i.fromTemplateUrl("templates/modal/groupProfile.html",{scope:e}).then(function(i){e.modal_group=i,t?(e.selected_group=angular.copy(t),e.selected_group.creator=t.room.creator.id==n.user.id,e.new_members=angular.copy(e.selected_group.members),e.new_group=!1):e.new_group=!0,e.modal_group.show()})},e.hideModalGroup=function(){e.selected_group={},e.modal_group.remove()},n.$on("categoryChanged",function(e,t){h(t.category)}),e.openModalVibe=function(){i.fromTemplateUrl("templates/modal/vibeModal.html",{scope:e}).then(function(t){e.modal_vibe=t,e.modal_vibe.show()})},e.removeModalVibe=function(){e.modal_vibe.remove()},e.openModalEvents=function(){i.fromTemplateUrl("templates/modal/eventsModal.html",{scope:e}).then(function(t){e.modal_events=t,e.modal_events.show()})},e.removeModalEvents=function(){e.modal_events.remove()}}]),angular.module("adbionic").controller("BuddiesCtrl",["$scope","$state","$rootScope","$ionicModal","GroupService","UserService","FriendshipService",function(e,t,n,i,a,o,r){function c(){if(e.adbBuddies)return e.buddies=e.adbBuddies.friends,void(e.userView=!0);if(e.buddies.length||s(),n.user&&n.user.birth){var t=moment(n.user.birth);e.user.hasParental=moment().diff(t,"year")>=18?!0:!1}a.init().then(function(){e.groups=a.groups;for(var t=0;t<e.groups.length;t++)for(var n in e.groups[t].members)e.groups[t].status=e.groups[t].members[n].status;console.log(e.groups),e.loading_groups=!1})}function s(){e.loading_buddies=!0,r.getMyBuddies()["finally"](function(){e.loading_buddies=!1})}console.log("Buddies"),e.loading_buddies=!1,e.loading_groups=!0,e.userView=!1,e.buddies=r.buddies,e.new_buddy={loading:!1},e.new_group={loading:!1},e.user={},c(),e.accept=function(t,n){e.new_buddy.loading=!0,e.new_buddy.loadingText="Accepting invitation...",r.accept({id:n}).then(function(t){e.new_buddy.message="Congralutations! You are buddies now, start a chat message with your new buddy",e.new_buddy.finished=!0})["finally"](function(){s()})}}]),angular.module("adbionic").controller("BuddyProfileCtrl",["$scope","$rootScope","$state","LocalService","FriendshipService","ConversationsService",function(e,t,n,i,a,o){e.new_buddy={},e.openChat=function(t,a){e.hideModalProfile(),i.set("fromChat",t),n.go("app.chats",{},{reload:!0})},e.invite=function(){e.loading=!0,e.loadingText="Sending invitation...",a.invite({userId:e.selected_buddy.id,type:0}).then(function(t){e.message="Invitation sent",e.hideModalProfile()},function(e){console.log(e)})["finally"](function(){e.loading=!1})},e.blockBuddy=function(){a.remove(e.selected_buddy,!0)["finally"](function(){e.selected_buddy={},e.hideModalProfile()})},e.unbuddy=function(){a.remove(e.selected_buddy,!1)["finally"](function(){e.selected_buddy={},e.hideModalProfile()})},e.searchBuddy=function(){e.loading=!0,e.message=null,e.loadingText="Searching...",a.search({buddyNumber:e.new_buddy.buddyNumber}).then(function(t){t.friendshipData.isMyBuddy?e.message=t.user.fullname+" is already your buddy!":t.friendshipData.requestAlreadySent?(e.selected_buddy=angular.copy(t.user),e.message="Waiting for Buddyship"):t.notFound?(e.selected_buddy=angular.copy(t.notFound.relatedUser),e.canInvite=!0):(e.selected_buddy=angular.copy(t.user),e.canInvite=!0),e["new"]=!1})["finally"](function(){e.loading=!1})}}]),angular.module("adbionic").controller("ChatsCtrl",["$scope","$rootScope","$ionicModal","LocalService","GroupService","ConversationsService","FriendshipService",function(e,t,n,i,a,o,r){function c(){if(console.log("service",i.get("fromChat")),i.get("fromChat")){var t=i.get("fromChat");o.openChat(t).then(function(t){i.unset("fromChat"),e.openConversation(t)})}r.getMyBuddies()}function s(n){for(var i=0,a=n.length-1;a>=0;--a)n[a].hasOwnProperty("messages")&&n[a].messages.length&&"read"!=n[a].messages[n[a].messages.length-1].status&&n[a].messages[n[a].messages.length-1].creator.id!=t.user.id&&i++;e.unread=i}e.unread=0,e.isOpen=!1,e.groups=a.conversations,e.conversations=o.conversations,t.loading_messages=[],console.log("Chats"),c(),e.isFriend=function(e){return r.isFriend(e)},e.toggle=function(){e.isOpen=!e.isOpen},e.openChatOptions=function(e){e.stopPropagation()},e.openConversation=function(i){e.conversation=i,e.conversation.params={limit:5,page:1},t.conversation_isopen=!0;var a=e.conversation.id;t.loading_messages[a]=!0,o.messagesPagination(a,e.conversation.params).then(function(i){e.conversation.messages=i.messages,e.conversation._isHide&&(e.conversations[index]._isHide=!1);var r=e.conversation;r.hasOwnProperty("messages")&&r.messages.length>0?(r.messages[r.messages.length-1].status="read",o.updateMessage(r.messages[r.messages.length-1].id)):r.messages=[],t.loading_messages[a]=!1,n.fromTemplateUrl("templates/conversations.html",{scope:e}).then(function(t){e.modal_conversation=t,e.modal_conversation.show()})})},e.closeConversation=function(){e.modal_conversation.remove()},e.isURL=function(e){var t=/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/;return t.test(e)},e.$watch("conversations",function(e,t){e&&s(e)},!0),t.$on("openChat",function(t,n,i){console.log("come from service"),i?$timeout(function(){e.openConversation(n)},200):e.openConversation(n)})}]),angular.module("adbionic").controller("ConversationsCtrl",["$scope","$rootScope","$timeout","$filter","$ionicPlatform","$cordovaImagePicker","ImageUploadFactory","ConversationsService","UtilService","SocketService","ActivityService",function(e,t,n,i,a,o,r,c,s,u,d){function l(){e.conversation["new"]={},e.conversation.collapsed=!1,e.conversation.isGroup?e.conversation.title=e.conversation.name:e.conversation.creator.id==t.user.id?(e.conversation.title=e.conversation.guest.fullname,e.conversation.buddy=e.conversation.guest):(e.conversation.title=e.conversation.creator.fullname,e.conversation.buddy=e.conversation.creator),console.log(e.conversation.buddy)}function f(t){e.loading=!0,e.activityId=m(t),d.getDetail(e.activityId).then(function(t){e.activity=t.activity,e.activity.participants=t.participants,e.loading=!1,p()})}function m(e){var t=e.split("[search:");return t[t.length-1].slice(0,-1)}function p(){for(var n=e.activity.participants.length-1;n>=0;n--){var i=e.activity.participants[n];e.activity.participants[n].fullname=i.user?i.user.fullname:"",e.activity.participants[n].profileImage=i.user?i.user.profileImage:"",e.activity.status=e.activity.participants[n].status,i.user&&i.user.id==t.user.id&&"requested"==e.activity.participants[n].status?e.showInvitation=!0:e.showInvitation=!1}}function g(t){angular.copy({},e.conversation["new"]),e.content=""}e.conversations=c.conversations,e.content="",e.openMenu=!1,e.openShared=!1,e.new_search={vibe:!0,category:"social",activities:[],type:"public",participants:[t.user]},l(),e.isURL=function(e){var t=/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/;return t.test(e)},e.toggle=function(){t.conversation_isopen=!1,e.conversation.collapsed=!e.conversation.collapsed,!e.conversation.collapsed&&e.conversation.messages.length>0&&(e.conversation.messages[e.conversation.messages.length-1].status="read",c.updateMessage(e.conversation.messages[e.conversation.messages.length-1].id))},e.addToBuddies=function(e){console.log("addToBuddies",e),FriendshipService.invite({userId:e.id,type:1}).then(function(e){console.log(e),s.showToast("Invitation sent")},function(e){console.log(e)})},e.attach=function(){console.log("selecting image");var t={maximumImagesCount:1,width:800,height:800,quality:80};a.ready(function(){o.getPictures(t).then(function(t){t.length>0&&r.uploadImage(t[0]).then(function(t){console.log(t),e.content=t.url,e.send()})},function(e){console.log("Error: "+JSON.stringify(e))})})},e.checkActivity=function(e){f(e)},e.openSearch=function(){openSearch(e.activity)},e.send=function(){e.content&&n(function(){e.conversation.writing=!1;var n={messageIdFromClient:s.uid(10),content:e.content,creator:t.user.id,conversation:e.conversation.id},i=c.find(e.conversation.id);c.conversations[i].messages.push({createdAt:moment().format(),content:e.content,creator:{profileImage:t.user.profileImage,fullname:t.user.fullname,id:t.user.id},messageIdFromClient:n.messageIdFromClient,status:"read"}),c.sendMessage(n),g(e.conversation)},0)},e.sendEvent=function(n){c.sendEvent({room:e.conversation.id,user:t.user.username})},t.$on("handshake",function(n,i){t.$emit("sendMessage",e.conversation,"[search:"+i.id+"]")}),e.$watchCollection("conversations",function(e,t){e&&0!==e.length&&_.map(e,function(e){e._subscribed||e.isGroup||(e._subscribed=!0,e.tab=0,u.subscribe("/room/"+e.id+"/subscribe/"))})}),t.$on("sendMessage",function(t,n,i){console.log(e.conversation,i),e.content=i,e.send()}),e.$watchCollection("conversation.messages",function(t,n){t&&(e.images=_.filter(t,function(t){return e.isURL(t.content)?t:void 0}),e.images=_.reverse(e.images),console.log(e.images),e.images=_.groupBy(e.images,function(e){return moment(moment(e.createdAt).startOf("day")).format()}))}),u.connection.on("room",function(t){e.$apply(function(){switch(!0){case"messaged"===t.verb:switch(!0){case"message"===t.data.model:var n=t.data.payload;console.log(n);var i=_.find(c.conversations,function(e){return e.id===n.conversation});console.log(i),i._isHide&&(i._isHide=!1);var a=_.findIndex(i.messages,function(e){return e.messageIdFromClient===n.messageIdFromClient});console.log(a);var o=_.findIndex(c.conversations,function(e){return e.id===n.conversation});console.log(o),o>=0&&(n.status="read"),0>a&&e.conversation.messages.push(n);break;case"room"===t.data.model:break;case"event"===t.data.model:console.log(t);break;default:console.log(t)}break;default:console.log(t)}})})}]),angular.module("adbionic").controller("DashboardCtrl",["$scope","$state","$rootScope","UserService","ActivityService","FriendshipService","GroupService",function(e,t,n,i,a,o,r){function c(){return e.user=n.user,n.$broadcast("categoryChanged",{category:e.new_search.category}),e.user.completedSignup||t.go("completesignup",{},{reload:!0}),i.resume().then(function(e){_.map(e,function(e,t){n.user[t]=e.count})}),e.loading_events=!0,a.getEvents({initDate:moment().startOf("day"),endDate:moment().endOf("day")}).then(function(t){e.today_events=[],0==t.activities.length&&(e.loading_events=!1),e.events=t.activities;for(var n=t.categories,i=0;i<e.events.length;i++)if(e.events[i].date==moment().format("YYYY-M-DD")){e.today_events=angular.copy(e.events[i].events);break}for(var i=0;i<e.today_events.length;i++)e.today_events[i].name=n[e.today_events[i].name];e.loading_events=!1}),e.adbBuddies?(e.buddies=e.adbBuddies.friends,void(e.userView=!0)):(e.buddies.length||s(),r.init().then(function(){e.groups=r.groups;for(var t=0;t<e.groups.length;t++)for(var i in e.groups[t].members)e.groups[t].status=e.groups[t].members[i].status;n.user.groups=e.groups,e.loading_groups=!1}),e.loading_search=!0,e.adbSearches?(e.activities=e.adbSearches.activities,e.userView=!0,void(e.loading_search=!1)):(e.activities.length?e.loading_search=!1:a.getSearches({}).then(function(t){e.loading_search=!1}),void(e.invites.length||a.getSearchesInvited())))}function s(){e.loading_buddies=!0,o.getMyBuddies()["finally"](function(){e.loading_buddies=!1})}console.log("Dashboard"),e.loading_buddies=!1,e.loading_groups=!0,e.buddies=o.buddies,e.invites=a.invites,e.activities=a.searches,e.new_search={vibe:!0,category:"social",activities:[],type:"public",participants:[]},c(),e.selectCategory=function(t){e.new_search.category=t,n.$broadcast("categoryChanged",{category:t})}}]),angular.module("adbionic").controller("EventsCtrl",["$scope","$state","$rootScope","ActivityService",function(e,t,n,i){function a(){e.loading_events=!0,i.getEvents({initDate:r,endDate:c}).then(function(t){e.new_activities=[],e.activities=t.activities,s=t.categories;for(var n=r.clone();n.isBefore(c);){for(var i=0;i<e.activities.length;i++)if(n.format("YYYY-M-DD")==e.activities[i].date){e.activities[i].date=moment(e.activities[i].date,"YYYY-M-DD").format("dddd, DD"),e.activities_month.push(e.activities[i]);for(var a=0;a<e.activities[i].events.length;a++)-1==e.activities[i].events[a].endDate&&(u.push(e.activities[i].events[a]),e.activities[i].events.splice(a,1));e.activities[i].events=e.activities[i].events.concat(u);break}e.new_activities.push({date:n.format("dddd, DD"),events:u}),n.add(1,"day")}console.log("...",e.new_activities),e.loading_events=!1})}var o="MMMM",r=moment().startOf("month"),c=moment().endOf("month");e.month=r.format(o),e.activities_month=[];var s={},u=[];a(),e.getActivityName=function(e){return s[e].name},e.next=function(){r=r.add(1,"months").startOf("month"),c=r.clone().endOf("month"),e.month=r.format(o),e.activities_month=[],a()},e.prev=function(){r=r.subtract(1,"months").startOf("month"),c=r.clone().endOf("month"),e.month=r.format(o),e.activities_month=[],a()}}]),angular.module("adbionic").controller("GroupProfileCtrl",["$scope","$rootScope","GroupService",function(e,t,n){function i(e){return{id:e.id,creator:t.user.id,name:e.name,isPrivate:e.isPrivate,topic:e.topic,roomImage:e.roomImage}}e.createGroup=function(){e.loading=!0;var i=_.map(e.new_members,function(e){return e.id}),a={};a=angular.copy(e.selected_group.room),a.members=e.new_members,a.users=i,a.creator=t.user.id,console.log(a),n.create(a).then(function(t){e.loading=!1,hideModalGroup()})},e.updateGroup=function(){e.loading=!0,n.update(i(e.selected_group.room)).then(function(t){e.hideModalGroup()})["finally"](function(){e.loading=!1})},e.selectBuddy=function(t){t.invited=!t.invited;var n=_.findIndex(e.new_members,{id:t.id});n>-1?e.new_members.splice(n,1):e.new_members.push(t)}}]),angular.module("adbionic").controller("HomeCtrl",["$scope","$state",function(e,t){setTimeout(function(){t.go("login")},3e3)}]),angular.module("adbionic").controller("LoginCtrl",["$scope","$state","$rootScope","$ionicPopup","Auth","UserService","UtilService",function(e,t,n,i,a,o,r){function c(){r.getSettings().then(function(e){s=e.settings.maxDaysToActivateAccount})}console.log("Login"),e.formLogin={},e.loading=!1;var s=7;c(),e.loginAttempt=function(){e.error=!1,e.loading=!0,a.login(e.formLogin).then(function(i){n.user=i.user,!i.user.userValidated&&moment().diff(moment(i.user.createdAt),"day")>s?n.userEmail=i.user.email:(o.setLogin(),e.user.completedSignup?t.go("app.dashboard"):t.go("completesignup"))},function(e){var t=i.alert({title:"Ups!",template:"User or password invalid"});t.then(function(e){console.log("User or password invalid")})})["finally"](function(){e.loading=!1})}}]),angular.module("adbionic").controller("NewSearchCtrl",["$scope","$rootScope","$q","$ionicPlatform","$cordovaImagePicker","ImageUploadFactory","ActivityService","UtilService","uiGmapGoogleMapApi","uiGmapIsReady",function(e,t,n,i,a,o,r,c,s,u){function d(){s.then(function(t){m=new t.places.AutocompleteService,u.promise(1).then(function(n){e.placesReady=!0,e.map.instance=n[0].map,Places=new t.places.PlacesService(e.map.instance)})})}function l(){e.loadingCategories=!0,r.getCategories(e.new_search.category).then(function(t){e.categories=t.subcategories})["finally"](function(){e.loadingCategories=!1})}var f="DD/MM/YYYY hh:mm a",m=null;e.placesReady=!1,e.map={center:{latitude:45.50174502816667,longitude:-73.5703881829977},zoom:14,options:{scrollwheel:!1},mapMarker:!0,disableDefaultUI:!0,control:{}},e.object={filter:null},e.data={},e.new_search={},e.new_search.participants=[],e.new_search.imageGallery=[],d(),e.getLocation=function(){e.new_search.addressPlace&&Places.getDetails({placeId:e.new_search.addressPlace.place_id},function(t,n){e.new_search.location=t.geometry.location,console.log(e.new_search)})},e.setLocation=function(t){e.new_search.addressPlace=t,e.new_search.address=t.description,e.places=[],e.getLocation()},e.autocompleteAddress=function(t){t&&m.getQueryPredictions({input:t},function(t){e.places=t})},e.clickActivity=function(t){var n=_.findIndex(e.new_search.activities,t);n>-1?(e.new_search.activities.splice(n,1),t.added=!1):e.new_search.activities.length<5&&(e.new_search.activities.push(t),t.added=!0)},e.selectCategory=function(t){e.new_search.category=t,e.new_search.activities=[],l()},e.nextStep=function(){e.step=e.step+1>5?5:e.step+1},e.prevStep=function(){e.step=e.step-1<1?1:e.step-1},e.clickBuddy=function(t){var n=_.findIndex(e.new_search.participants,t);n>-1?e.new_search.participants.splice(n,1):e.new_search.participants.push(t)},e.checkBuddy=function(t){return _.findIndex(e.new_search.participants,t)>-1},e.search=function(){e.loading=!0,e.new_search.startDate=moment(e.startDate,f),"Until Further Notice"==e.endDate?e.new_search.endDate=-1:e.new_search.endDate=moment(e.endDate,f),e.new_search.create=!0,r.search(e.new_search).then(function(n){e.activities=r.mapMarkers(n.users,n.groupByLocation),t.$emit("newSearch"),e.isFromChat&&t.$emit("handshake",n.activity[0])})["finally"](function(){e.loading=!1,e.hideModalNewSearch()})},e.choosePicture=function(){var t={maximumImagesCount:1,width:800,height:800,quality:80};i.ready(function(){a.getPictures(t).then(function(t){t.length>0&&o.uploadImage(t[0]).then(function(t){e.new_search.imageGallery.push(t.url)})},function(e){console.log("Error: "+JSON.stringify(e))})})},e.removeItem=function(t){e.new_search.imageGallery.splice(t,1)},e.unofficial=function(){e.new_search.activities.push({id:c.uid(2),parent:e.new_search.category||"social",name:_.capitalize(_.trim(e.object.filter)),userId:c.uid(10),isNew:!0}),e.object.filter=null}}]),angular.module("adbionic").controller("NotificationsCtrl",["$scope","$state","$rootScope","$ionicPopup","UserService","NotificationService",function(e,t,n,i,a,o){function r(){if(e.notifications.length){e.readed=[];for(var t=0;t<e.notifications.length;++t)e.notifications[t].isInvitation||(e.readed.push(e.notifications[t].id),e.notifications[t].readed=!0);a.readNotifications({ids:e.readed}).then(function(e){console.log(e)})}}e.readed=[],e.notifications=o.list,r(),e.handle=function(t,i){t._loading=!0,o[t.handler](t,i).then(function(o){t._loading=!1;var r=_.findIndex(e.notifications,function(e){return e.id==t.id});e.notifications[r].readed=!0,a.readNotifications({ids:[t.id]}),"groupInvitation"!=t.type||i||n.$emit("updateGroups")})},e.showConfirm=function(t){var n=i.confirm({title:"Do you want to accept this request or invitation?",cssClass:"popup-confirmation",cancelText:"No",okText:"Yes",okType:"button-next"});n.then(function(n){n?e.handle(t):e.handle(t,!0)})}}]),angular.module("adbionic").controller("SearchCtrl",["$scope","$rootScope","ActivityService",function(e,t,n){function i(){e.activities=[],e.activities_archived=[],e.loading_search=!0,n.getSearches({}).then(function(t){for(var n=0;n<t.activities.length;n++)t.activities[n].archived?e.activities_archived.push(t.activities[n]):e.activities.push(t.activities[n]);e.aux_activities=angular.copy(e.activities),e.loading_search=!1})}function a(){for(var t=[],n=0;n<e.activities.length;n++)e.categories.indexOf(e.activities[n].category)>-1&&t.push(e.activities[n]);e.aux_activities=t}e.categories=["handy","social","active"],i(),e.selectCategory=function(t){var n=e.categories.indexOf(t);n>-1?e.categories.splice(n,1):e.categories.push(t),a()},t.$on("newSearch",function(e,t){i()})}]),angular.module("adbionic").controller("SearchDetailCtrl",["$scope","$rootScope","$timeout","ActivityService","uiGmapGoogleMapApi","uiGmapIsReady",function(e,t,n,i,a,o){function r(){e.mapVisible=!0,a.then(function(t){o.promise(1).then(function(t){e.map.instance=t[0].map,c(),e.marker.id=0,e.marker.location=e.map.center,e.marker.icon=i.getIcon(e.activity.category),console.log(e.marker),e.markers=[e.marker],
e.participants.forEach(function(t,n){var n=_.find(e.buddies,{id:t.id});n&&(n.invited=!0)})})})}function c(){e.map.center={latitude:e.activity.location[0],longitude:e.activity.location[1]}}e.marker={},e.mapVisible=!1,e.map={center:{latitude:45.50174502816667,longitude:-73.5703881829977},zoom:14,options:{scrollwheel:!1},disableDefaultUI:!0,control:{},streetViewControl:!1},r(),e.selectBuddy=function(t){t.invited=!t.invited;var n=_.findIndex(e.participants,{id:t.id});n>-1?e.participants.splice(n,1):e.participants.push(t)},e.inviteSearch=function(){var t=e.participants;t.length&&i.invite({activity:e.activity.id,participants:t}).then(function(t){e.hideModalSearch()},function(e){console.log(e)})},e.$watch("mapVisible",function(t,i){t&&angular.isObject(e.map.control)&&n(function(){e.map.control.refresh()},0)})}]),angular.module("adbionic").controller("SearchFindCtrl",["$scope","$rootScope","$timeout","uiGmapGoogleMapApi","uiGmapIsReady",function(e,t,n,i,a){function o(){i.then(function(t){c=new t.places.AutocompleteService,a.promise(1).then(function(n){e.placesReady=!0,e.map.instance=n[0].map,r=new t.places.PlacesService(e.map.instance)})})}var r=null,c=null;e.placesReady=!1,e.map={center:{latitude:45.50174502816667,longitude:-73.5703881829977},zoom:14,options:{scrollwheel:!1},mapMarker:!0,disableDefaultUI:!0,control:{}},e.data={};var s="DD/MM/YYYY hh:mm a",u="#datetimepicker-start";o(),e.getLocation=function(){e.new_search.addressPlace&&r.getDetails({placeId:e.new_search.addressPlace.place_id},function(t,n){e.new_search.location=t.geometry.location})},e.setLocation=function(t){e.new_search.addressPlace=t,e.new_search.address=t.description,e.places=[],e.getLocation()},e.autocompleteAddress=function(t){t&&c.getQueryPredictions({input:t},function(t){e.places=t})},e.clickActivity=function(t){var n=_.findIndex(e.new_search.activities,t);n>-1?(e.new_search.activities.splice(n,1),t.added=!1):e.new_search.activities.length<5&&(e.new_search.activities.push(t),t.added=!0)},e.now=function(){e.startDate=moment().format(s),$(u).data("DateTimePicker").date(e.startDate)},e.until=function(){e.active=!1,n(function(){e.endDate="Until Further Notice"},0)}}]),angular.module("adbionic").controller("SettingsCtrl",["$scope","$rootScope","$ionicPlatform","$cordovaImagePicker","ImageUploadFactory","UserService","ActivityService",function(e,t,n,i,a,o,r){function c(){r.getCategories("all").then(function(n){e.activities_all=n.res,e.data.username=t.user.username,e.data.fullname=t.user.fullname,e.data.showName=t.user.showName,e.data.showUsername=t.user.showUsername,e.data.country=t.user.country,e.data.city=t.user.city,e.data.gender=t.user.gender,e.data.profileImage=t.user.profileImage,e.data.biography=t.user.biography,e.data.preferredActivities=t.user.preferredActivities,e.data.id=t.user.id,e.data.birth=moment(t.user.birth).format("MMMM Do, YYYY"),e.data.preferredActivities=t.user.preferredActivities||[],e.isValidDate=!0,s()})}function s(){e.data.preferredActivities.forEach(function(t,n){var i=t.parent;if("Social"==i){var a=e.activities_all.Social,n=_.find(a,{name:t.name});n&&(n.user=!0),e.activities_all.Social=_.sortBy(a,["user"])}if("Handy"==i){var a=e.activities_all.Handy,n=_.find(a,{name:t.name});n&&(n.user=!0),e.activities_all.Handy=_.sortBy(a,["user"])}if("A"==i){var a=e.activities_all.Training,n=_.find(a,{name:t.name});n&&(n.user=!0),e.activities_all.Training=_.sortBy(a,["user"])}})}e.tab_settings=1,e.data={},c(),e.updateProfile=function(){e.loading=!0,(e.data.showName||e.data.showUsername||(e.data.fullname&&(e.data.showName=!0),e.data.username&&(e.data.showUsername=!0),e.data.fullname||e.data.username))&&(e.data.fullname||e.data.username)&&(e.data.birth=moment(e.data.birth,"MMMM Do, YYYY"),e.data.country=angular.isObject(e.data.country)?e.data.country.name:e.data.country,o.update(e.data.id,e.data).then(function(t){e.error=!1,e.hideModalSettings()},function(t){e.error=!0})["finally"](function(){e.loading=!1}))},e.selectPreferred=function(t,n){t.user=!t.user;var i=_.findIndex(e.data.preferredActivities,{parent:n,name:t.name});i>-1?e.data.preferredActivities.splice(i,1):e.data.preferredActivities.push(t)},e.selectImage=function(){console.log("selecting image");var t={maximumImagesCount:5,width:800,height:800,quality:80};n.ready(function(){i.getPictures(t).then(function(t){for(var n=0;n<t.length;n++)console.log("Image URI: "+t[n]);t.length>0&&a.uploadImage(t[0]).then(function(t){console.log(t),e.data.profileImage=t.url})},function(e){console.log("Error: "+JSON.stringify(e))})})},e.changePassword=function(){e.loading=!0,o.changePassword({currentPassword:e.data.currentPassword,newPassword:e.data.newPassword,confirmNewPassword:e.data.confirmPassword}).then(function(t){e.loading=!1,e.hideModalSettings(),e.error=!1},function(t){e.error=!0,e.loading=!1})},e.validateDate=function(){e.isValidDate=moment(e.data.birth,"MMMM Do, YYYY").isValid()}}]),angular.module("adbionic").controller("SignUpCtrl",["$scope","$state","$rootScope","$ionicModal","$auth","$cordovaImagePicker","ImageUploadFactory","Auth","UserService","UtilService","ActivityService",function(e,t,n,i,a,o,r,c,s,u,d){function l(){e.loadingActivities=!0,d.getCategories("all",{all:!0,official:!0}).then(function(t){e.activities=t.res,e.loadingActivities=!1})}function f(t){var n=t?e.countries.filter(m(t)):e.countries;return n}function m(e){var t=_.capitalize(e);return function(e){return 0===e.name.indexOf(t)}}console.log("SignUp"),e.step=1,e.loading=!1,e.countries=u.getCountries(),e.data={city:"",country:"",gender:"M",birth:null,showName:!0,showUsername:!1,profileImage:u.defaultAvatar,imageGallery:[],preferredActivities:[]},e.availability=!0,e.isConfirm=!0;var p="MMMM Do, YYYY";l(),e.signAttempt=function(){e.loading=!0,c.register(e.data).then(function(e){n.userEmail=e.user.email,t.go("completesignup")},function(t){console.log(t),e.error=!0})["finally"](function(){e.loading=!1})},e.authenticate=function(e){a.authenticate(e).then(function(e){c.setCredentials(e.data),t.go("app.dashboard")})["catch"](function(e){console.log(e)})},e.checkCredentailsAvailability=function(t){var n={};e.data[t]&&(e.loading=!0,n[t]=e.data[t],c.credentialAvaliability(n).then(function(t){e.availability=t.availability,e.loading=!1},function(t){console.log(t),e.loading=!1}))},e.compare=function(){e.isConfirm=e.data.confirmPassword==e.data.password},e.validateDate=function(){e.isValidDate=moment(e.data.birth,p).isValid()},e.nextStep=function(){e.step++,1==e.step&&(n.user.username=e.data.username)},e.previousStep=function(){1==e.step?t.go("login"):e.step=e.step-1<1?1:e.step-1},e.autocompleteCountry=function(e){return f(e)},i.fromTemplateUrl("templates/modal/signupModal.html",{scope:e}).then(function(t){e.modal_signup=t}),e.openSignModal=function(t,n){e.modal_signup.show(),e.action=t,e.placeholder=n},e.okSignModal=function(){e.modal_signup.hide()},e.clickCountry=function(t){e.data.country=t.name},e.selectActivity=function(t){var n=_.findIndex(e.data.preferredActivities,t);n>=0?e.data.preferredActivities.splice(n,1):e.data.preferredActivities.push(t)},e.checkActivity=function(t){return _.findIndex(e.data.preferredActivities,t)>=0},e.complete=function(){e.loading=!0,e.data.completedSignup=!0,e.data.country=e.data.country.name,t.go("app.dashboard")},e.choosePicture=function(){var t={maximumImagesCount:5,width:800,height:800,quality:80};$ionicPlatform.ready(function(){o.getPictures(t).then(function(t){for(var n=0;n<t.length;n++)console.log("Image URI: "+t[n]);t.length>0&&r.uploadImage(t[0]).then(function(t){e.data.profileImage=t.url})},function(e){console.log("Error: "+JSON.stringify(e))})})}}]),angular.module("adbionic").controller("VibeCtrl",["$scope","$state","$rootScope","$timeout","uiGmapGoogleMapApi","uiGmapIsReady","UtilService","ActivityService",function(e,t,n,i,a,o,r,c){function s(){a.then(function(t){o.promise(1).then(function(t){e.map.instance=t[0].map,e.bounds=e.map.instance.getBounds(),u()})})}function u(){r.getLocation().then(function(t){e.location=t,f(e.map.instance,e.location)})["finally"](function(){e.mapVisible=!0})}function d(e){FriendshipService.invite({userId:e,type:1}).then(function(e){r.showToast("Invitation sent")},function(e){console.log(e)})}function l(){var t=[];angular.forEach(e.data,function(n,i){var a=0;angular.forEach(n,function(t,n){a+=e.participantsCount(t)+t.length}),e.activity&&e.activity==i&&e.updateMap(e.activity,n),e.participants[i]=a,t.push(c.mapMarkers(e.users,n))});var n=[],i={};for(var a in e.participants)n.push([a,e.participants[a]]);n.sort(function(e,t){return t[1]-e[1]});for(var o=0;o<n.length;o++){var a=n[o][0];i[a]=e.data[a]}e.data=i,e.allActivities=[].concat.apply([],t),e.allActivities.push(m()),e.allActivities.map(function(e,t){e.id=t}),e.activity||angular.copy(e.allActivities,e.activities)}function f(e,t,n){i(function(){e.panTo(t)},100)}function m(){return{text:"This is you!",location:{latitude:e.location.lat,longitude:e.location.lng},icon:c.marker("green",1)}}function p(){var t={startDate:moment().format(),endDate:moment().format(),categories:["social","handy","active"],lat:e.location.lat,lng:e.location.lng,radius:e.radius};e.loading=!0,c.vibe(t).then(function(t){e.data=t.vibe,e.users=t.users,e.categories=t.categories,l()})["finally"](function(){e.loading=!1})}function g(){var t=3963,n=e.bounds.getNorthEast(),i=e.bounds.getCenter();if(e.location){var a=e.location.lat/57.2958,o=e.location.lng/57.2958,r=i.lat()/57.2958,c=i.lng()/57.2958,s=t*Math.acos(Math.sin(a)*Math.sin(r)+Math.cos(a)*Math.cos(r)*Math.cos(c-o));r=n.lat()/57.2958,c=n.lng()/57.2958;var u=t*Math.acos(Math.sin(a)*Math.sin(r)+Math.cos(a)*Math.cos(r)*Math.cos(c-o));s+u>e.radius&&1e3>u&&(e.radius=(s+u).toFixed(2),p())}}function v(){e.map.instance&&(e.bounds=e.map.instance.getBounds(),g())}e.radius=0,e.bounds=null,e.marker=null,e.loading=!0,e.activity=null,e.activities=[],e.participants={},e.mapVisible=!1,e.allActivities=[],e.filter={categories:r.getCategories(),selectedCategories:[]},e.isOffering=!1,e.map={center:{latitude:45.50174502816667,longitude:-73.5703881829977},zoom:14,options:{scrollwheel:!1},control:{},events:{idle:v}},s(),e.resetFilter=function(){e.filter={categories:r.getCategories(),selectedCategories:[]}},e.markerClick=function(t,n,i){i.hasOwnProperty("text")||angular.isObject(i.activities[0].name)||(i.activities=c.populateCategory(e.categories,i.activities)),e.marker=i,e.marker.current={},e.marker.show=!e.marker.show},e.updateMap=function(t,n){e.activity=t,e.activities=c.mapMarkers(e.users,n),e.activities.push(m()),e.activities[e.activities.length-1].id=e.activities.length-1},e.openActivity=function(t){angular.isObject(t[0].name)||(t=c.populateCategory(e.categories,t)),e.marker={current:{},location:{latitude:t[0].location[0],longitude:t[0].location[1]},activities:t,users:e.users,show:e.marker&&_.isEqual(e.marker.activities,t)?!e.marker.show:!0},e.marker.show&&f(e.map.instance,{lat:e.marker.location.latitude,lng:e.marker.location.longitude},!0)},e.closeActivity=function(){e.activity=null,angular.copy(e.allActivities,e.activities),e.marker&&(e.marker.show=!1)},e.participantsCount=function(e){for(var t=0,n=e.length-1;n>=0;--n)t+=e[n].participants.length;return t},e.joinTheVibe=function(){var t=e.marker.current;d(t.requester),c.join(t._id).then(function(e){})},e.$watch("mapVisible",function(t,n){t&&angular.isObject(e.map.control)&&i(function(){e.map.control.refresh()},0)});var h;e.$watch("filter",function(t,n){if(console.log(t),t!=n&&e.location){i.cancel(h);var a=t.selectedCategories;h=i(function(){var n={startDate:t.startDate?moment(t.startDate).format():null,endDate:t.endDate?moment(t.endDate).format():null,categories:a,activity:t.search,lat:e.location.lat,lng:e.location.lng,radius:e.radius};c.vibe(n).then(function(t){e.data=t.vibe,e.users=t.users,e.categories=t.categories,e.participants={},e.data_original=angular.copy(e.data),l()})["finally"](function(){e.loading=!1})},500)}},!0),e.$watch("$scope.isOffering",function(t,n){t!=n&&"handy"==e.filter.selectedCategories&&(e.data_aux={},angular.forEach(e.data_original,function(t,n){angular.forEach(t,function(t,i){t[0].isOffering==e.isOffering&&(e.data_aux[n]=e.data_original[n])})}),e.data=angular.copy(e.data_aux),e.participants={},l())})}]),function(){"use strict";function e(e,t,n,i,a,o){function r(t){var n=a.defer();return i.post(e+"/activity/",P(t)).success(function(e,t,i,a){$(e),A(e),M(e.activity),n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function c(t){var n=a.defer();return i.put(e+"/activity/",P(t)).success(function(e,t,i,a){y({}),n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function s(t){var n=a.defer();return i["delete"](e+"/activity/"+t).success(function(e){y(),n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function u(t){console.log("/activity/vibe/3");var n=a.defer();return i.get(e+"/activity/vibe/",{params:t}).success(function(e){$(e),A(e),M(e.activity),e.location=t,n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function d(t){var n=a.defer();return i.post(e+"/activity/invite/",t).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function l(t){var n=a.defer();return i.post(e+"/activity/kick/",t).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function f(t){var n=a.defer();return i.post(e+"/activity/acceptRequest/",t).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function m(t){var n=a.defer();return i.post(e+"/activity/rejectRequest/",t).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function p(t){var n=a.defer();return i.post(e+"/activity/join/",{activity:t}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function g(t){var n=a.defer();return i.post(e+"/activity/daily/",t).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function v(t){var n=a.defer();return i.get(e+"/category/"+t+"?all=true").success(function(e){n.resolve(e),angular.copy(e.subcategories,N.categories)}).error(function(e){n.reject(e)}),n.promise}function h(){var t=a.defer();return i.get(e+"/user/activities/invited/").success(function(e){t.resolve(e),angular.copy(e,N.invites)}).error(function(e){t.reject(e)}),t.promise}function y(t){var n=a.defer();return i.get(e+"/user/activities/",{params:t}).success(function(e){n.resolve(e),angular.copy(e.activities,N.searches)}).error(function(e){n.reject(e)}),n.promise}function b(t){var n=a.defer();return i.get(e+"/activity/view/"+t).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function _(t){console.log("/activity/vibe/4");var n=a.defer();return i.get(e+"/activity/vibe/",{params:t}).success(function(e){$(e),A(e),M(e.activity),e.location=t,n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function S(e,t){var n=[],i=0;for(var a in t)n.push({id:i++,users:e,activities:t[a],location:{latitude:t[a][0].location[0],longitude:t[a][0].location[1]},icon:w(t[a][0].category)});return n}function w(e){return"social"==e?"img/dark-tiny-social.png":"handy"==e?"img/dark-tiny-handy.png":"active"==e?"img/dark-tiny-active.png":void 0}function M(e){e&&angular.copy(e.concat(N.searches),N.searches)}function A(e){for(var t in e.groupByLocation)C(e.users,e.groupByLocation[t])}function C(e,t){if(t&&e){for(var n=t.length-1;n>=0;--n)t[n].requester=e[t[n].requester];return t}}function $(e){for(var t in e.groupByLocation)I(e.categories,e.groupByLocation[t]);I(e.categories,e.activity)}function I(e,t){if(t&&e){for(var n=t.length-1;n>=0;--n)t[n].name=e[t[n].name];return t}}function k(){N.data={activities:[],participants:[]}}function P(e){return e.requester=o.user.id,e.startDate=n(e.startDate).format(),e.endDate=-1==e.endDate?-1:n(e.endDate).format(),e}function D(e){e=JSON.parse(JSON.stringify(e)),e.create=!1,e.existing=!0,e.activities=[e.name],e.participants=e.participants?e.participants:[],delete e.name,angular.copy(e,N.data)}function j(e,i){var a=[];return angular.forEach(i,function(i){var o=t.filter(i.events,{archived:!1});o.length&&a.push({title:o.length,start:n(i.date,"YYYY-MM-DD").toDate(),end:n("2016-06-07","YYYY-MM-DD").toDate(),events:I(e,o),allDay:!0,className:U(o)})}),a}function U(e){var n=t.filter(e,{status:"accepted"});return n.length?n.length==e.length?"invited-event":"mixed-event":"normal-event"}function B(t){var n=a.defer();return i.post(e+"/activity/reject/",{activity:t.activity}).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function T(t){var n=a.defer();return i.post(e+"/activity/accept/",{activity:t.activity}).success(function(e){n.resolve(e),angular.copy(e.activities,N.invites)}).error(function(e){n.reject(e)}),n.promise}function G(e,t){var n="spotlight-poi.png",i="http://mt.googleapis.com/vt/icon/name=icons/spotlight/";return"blue"==e&&(n="spotlight-waypoint-blue.png"),"green"==e&&(n="spotlight-waypoint-a.png"),i+n+"&scale="+t}var N={categories:[],searches:[],invites:[],data:{activities:[],participants:[]},date:{},getSearchesInvited:h,acceptInvitation:T,populateCategory:I,rejectInvitation:B,calendarEvents:j,getCategories:v,getSearches:y,acceptRequest:f,rejectRequest:m,mapMarkers:S,vibeFilter:_,getEvents:g,clearData:k,setUpdate:D,getDetail:b,search:r,update:c,remove:s,invite:d,marker:G,join:p,kick:l,vibe:u,getIcon:w};return N}angular.module("adbionic").factory("ActivityService",e),e.$inject=["BaseApiUrl","_","moment","$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n,i,a,o){function r(i){var a=n.defer();return t.post(e+"/auth/validate/"+i).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}function c(i){var r=n.defer();return t.post(e+"/auth/login",i).success(function(e,t,n,i){r.resolve(e),e.hasOwnProperty("token")&&(angular.copy(e.user,a.user),o.set("access_token",e.token),o.set("user",JSON.stringify(e.user)))}).error(function(e){r.reject(e)}),r.promise}function s(i){var a=n.defer();return t.post(e+"/auth/register",i).success(function(e,t,n,i){a.resolve(e),f(e)}).error(function(e){a.reject(e)}),a.promise}function u(i,a){var o=n.defer();return t.post(e+"/auth/resetpassword/"+i,a).success(function(e,t,n,i){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}function d(i){var a=n.defer();return t.post(e+"/auth/resetPasswordRequest",i).success(function(e,t,n,i){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}function l(){o.unset("access_token"),o.unset("user"),a.isAuthenticated=!1,a.user=null,a.currentState="login",i.go("login",{},{reload:!0})}function f(e,t){t&&m(),e.hasOwnProperty("token")?((t||!o.get("access_token"))&&o.set("access_token",e.token),a.user=e.user,o.set("user",JSON.stringify(e.user))):console.log("Bad Date",e)}function m(){o.set("orginal_access_token",o.get("access_token")),o.set("orginal_user",o.get("user"))}function p(){o.set("access_token",o.get("orginal_access_token")),o.set("user",o.get("orginal_user")),o.unset("orginal_access_token"),o.unset("orginal_user"),a.user=JSON.parse(o.get("user"))}function g(){return o.get("orginal_access_token")}function v(){if(o.get("access_token")){o.get("access_token");return!0}return!1}function h(){}function y(i){var a=n.defer();return t.get(e+"/user/availability/",{params:i}).success(function(e,t,n,i){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}var b={validate:r,authorize:h,isAuthenticated:v,login:c,logout:l,register:s,forgot:d,reset:u,setCredentials:f,setOriginalUser:m,restoreOriginal:p,hasOriginal:g,credentialAvaliability:y};return b}function t(e,t,n){function i(e){var n;return t.get("access_token")&&(n=t.get("access_token")),n&&(e.headers.Authorization="Bearer "+n),e}function a(i){return(401===i.status||403===i.status)&&(t.unset("access_token"),n.get("$state").transtionTo("login")),e.reject(i)}var o={request:i,responseError:a};return o}t.$inject=["$q","LocalService","$injector"],angular.module("adbionic").factory("Auth",e).factory("AuthInterceptor",t).config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor"),e.defaults.withCredentials=!0}]),e.$inject=["BaseApiUrl","$http","$q","$state","$rootScope","LocalService"]}(),function(){"use strict";function e(e,t,n,i,a,o){function r(){var e=$.get();return e.then(function(e){angular.copy(_.map(e.rooms,function(e){return e._subscribed=!1,e._isHide=!1,e}),$.conversations),console.log("Conversations",$.conversations)})}function c(){var i=a.defer(),o=t.get("access_token");return n.connection.get(e+"/user/room/?token="+o,null,function(e){i.resolve(e)}),i.promise}function s(i){var o=a.defer(),r={guest:i,type:"chat"},c=t.get("access_token");return n.connection.post(e+"/room/?token="+c,r,function(e){$.conversations.push(e),o.resolve(e)}),o.promise}function u(){var t=a.defer();return o.get(e+"/user/room/").success(function(e,n,i,a){t.resolve(e)}).error(function(e){t.reject(e)}),t.promise}function d(t){var n=a.defer(),i=$.find(t.id);return $.conversations.splice(i,1),o["delete"](e+"/room/"+t.id).success(function(e,t,i,a){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function l(e){var t=_.findIndex($.conversations,function(t){return t.id===e});return t}function f(e){var t=$.find(e.id);0>=t&&(console.log(e.id,t),e._subscribed=!1,e._isHide=!1,$.conversations.push(e))}function m(t){var n=a.defer(),i={guest:t,type:"chat"};return console.log("creating convo"),o.post(e+"/room/",i).success(function(e,t,i,a){n.resolve(e),$.push(e)}).error(function(e){n.reject(e)}),n.promise}function p(i){var o=(a.defer(),t.get("access_token"));n.connection.post(e+"/message/?token="+o,i,function(e){console.log("message sent")})}function g(e){for(var t=$.conversations.length-1;t>=0;--t)$.conversations[t].id===e&&$.conversations.splice(t,1)}function v(e){for(var t=$.conversations.length-1;t>=0;--t)$.conversations[t].id===e&&($.conversations[t]._isHide=!0,_.remove($.conversations[t].messages,void 0))}function h(e){for(var t=$.conversations.length-1;t>=0;--t)$.conversations[t].id===e&&($.conversations[t].isArchived=!0),$.conversations[t]._isHide=!0}function y(e){for(var t=$.conversations.length-1;t>=0;--t)$.conversations[t].id===e&&($.conversations[t].isClear=!0,_.remove($.conversations[t].messages,void 0))}function b(e,t,n){for(var i=n,a=$.conversations.length-1;a>=0;--a)$.conversations[a].id===e&&($.conversations[a][t]=i)}function S(t,n){var i=a.defer();return o.put(e+"/room/"+t+"/state",n).success(function(e,t,n,a){i.resolve(e),$[e.action](e.room)}).error(function(e){i.reject(e)}),i.promise}function w(i){var o=(a.defer(),t.get("access_token"));n.connection.post(e+"/room/event/?token="+o,i,function(e){console.log("event sent")})}function M(t){var n=a.defer();return o.put(e+"/message/"+t).success(function(e,t,i,a){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function A(e,t){var n=-1,i=a.defer();return n=t?_.findIndex($.conversations,function(e){return e.id===t}):_.findIndex($.conversations,function(t){return!t.isGroup&&(t.creator.id===e||t.guest.id===e)}),n>=0?i.resolve($.conversations[n]):$.postBySocket(e).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise}function C(t,n){var i=a.defer();return o.get(e+"/room/"+t+"/messages/",{params:n}).success(function(e,t,n,a){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise}var $={conversations:[],fromProfile:null,init:r,getbySocket:c,postBySocket:s,create:m,get:u,push:f,find:l,state:b,remove:g,archive:h,clear:y,hide:v,changeState:S,destroy:d,sendMessage:p,sendEvent:w,updateMessage:M,openChat:A,messagesPagination:C};return $}angular.module("adbionic").service("ConversationsService",e),e.$inject=["BaseApiUrl","LocalService","SocketService","$rootScope","$q","$http"]}(),function(){"use strict";function e(e,t,n,i){function a(i){var a=n.defer();return t.post(e+"/buddy/friendship/",i).success(function(e,t,n,i){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}function o(i){var a=n.defer();return t.get(e+"/user/buddies/",i).success(function(e,t,n,i){angular.copy(e.list,y.buddies),a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}function r(i){var a=n.defer();return t.post(e+"/friendship/"+i.id+"/accept").success(function(e,t,n,i){a.resolve(e),y.getMyBuddies()}).error(function(e){a.reject(e)}),a.promise}function c(i){var a=n.defer();return t.post(e+"/friendship/"+i.id+"/reject").success(function(e,t,n,i){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}function s(i){var a=n.defer();return t.get(e+"/buddy/"+i.buddyNumber).success(function(e,t,n,i){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}function u(i){var a=n.defer();return t.post(e+"/report/",i).success(function(e,t,n,i){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}function d(i,a){var o=n.defer();return f(i),t["delete"](e+"/friendship/"+i._relationship,{params:{block:a||!1}}).success(function(e,t,n,i){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}function l(i){var a=n.defer();return t.post(e+"/user/bump/"+i.id).success(function(e,t,n,i){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}function f(e){for(var t=y.buddies.length-1;t>=0;--t)y.buddies[t].id==e.id&&y.buddies.splice(t,1)}function m(e){for(var t=y.buddies.length-1;t>=0;--t)y.buddies[t]._relationship==e&&y.buddies.splice(t,1)}function p(e){var t=_.findIndex(y.buddies,function(t){return t.id==e});return t}function g(e){for(var t=y.buddies.length-1;t>=0;--t)if(y.buddies[t].id==e)return!0;return!1}function v(e,t){var n=y.buddies[e].id;if(y.buddies[e].isOnline=t,i.conversations.length>0){var a=_.findIndex(i.conversations,function(e){return!e.isGroup&&(e.creator&&e.creator.id==n||e.guest&&e.guest.id==n)});if(a>=0){var o=i.conversations[a];o&&o.creator.id===n?o.creator.isOnline=t:o&&o.guest.id===n&&(o.guest.isOnline=t)}}}function h(){console.log("accepting Invitation")}var y={buddies:[],mapchips:{name:"fullname",image:"profileImage"},acceptInvitationToGroup:h,removeLocalByRelationship:m,getMyBuddies:o,invite:a,accept:r,reject:c,acceptRequest:r,rejectRequest:c,changeStatus:v,search:s,find:p,report:u,remove:d,fistBump:l,isFriend:g};return y}angular.module("adbionic").factory("FriendshipService",e),e.$inject=["BaseApiUrl","$http","$q","ConversationsService"]}(),function(){"use strict";function e(e,t,n,i,a,o){function r(){var t=o.get("/group/");return t.then(function(t){angular.copy(t,h.groups),angular.copy(e.map(t,function(e){return e.room}),h.rooms),console.log("Groups",h.rooms)})}function c(e){var o=n.defer();return i.post(t+"/group/",e).success(function(e){h.groups.push(e),a.push(e.room),o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}function s(e){var a=n.defer();return i.put(t+"/group/",e).success(function(e){h.get(),a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}function u(a){var o=n.defer();return i["delete"](t+"/group/",{data:a}).success(function(t){h.groups.splice(e.findIndex(h.groups,function(e){return e.room.id==t.id}),1),o.resolve(t)}).error(function(e){o.reject(e)}),o.promise}function d(e){var a=n.defer();return i.post(t+"/group/invite/",e).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}function l(e){var a=n.defer();return i.post(t+"/group/kick/",e).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise}function f(){var e=n.defer();return i.get(t+"/group/").success(function(t){angular.copy(t,h.groups),e.resolve(t)}).error(function(t){e.reject(t)}),e.promise}function m(e){e.existing=!0,e.name=e.room.name,e.topic=e.room.topic,e.isPrivate=e.room.isPrivate,e.roomImage=e.room.roomImage,angular.copy(e,h.group)}function p(){h.group={name:"",members:[],isPrivate:!1,topic:"social"}}function g(){}function v(e){var o=n.defer();return i.post(t+"/group/accept/"+e.room).success(function(e){o.resolve(e),h.groups.push(e),a.push(e)}).error(function(e){o.reject(e)}),o.promise}var h={group:{name:"",members:[],isPrivate:!1,topic:"social"},rooms:[],groups:[],acceptInvitation:v,"delete":u,create:c,update:s,invite:d,clear:p,kick:l,init:r,open:g,get:f,set:m};return h}angular.module("adbionic").factory("GroupService",e),e.$inject=["_","BaseApiUrl","$q","$http","ConversationsService","SocketService"]}(),angular.module("adbionic").factory("ImageUploadFactory",["$q","$ionicLoading","$cordovaFileTransfer",function(e,t,n){return{uploadImage:function(i){function a(){t.show({template:"Uploading image..."});var e={params:{upload_preset:"sm2ev4nu",timestamp:Date.now()/1e3|0,api_key:839988333153567}};n.upload("https://api.cloudinary.com/v1_1/cloud9/image/upload",i,e).then(function(e){t.show({template:"Done.",duration:1e3});var n=JSON.parse(decodeURIComponent(e.response));o.resolve(n)},function(e){t.show({template:"Failed.",duration:3e3}),o.reject(e)},function(e){})}console.log("start upload image.");var o=e.defer();return a(),o.promise}}}]),function(){"use strict";function e(e){var t={request:function(e){return e},response:function(e){return e},responseError:function(t){return console.log(t.data),401===t.status&&console.log("unauthorized"),e.reject(t)},requestError:function(t){return console.log(t),e.reject(t)}};return t}angular.module("adbionic").factory("interceptorsService",e),e.$inject=["$q"]}(),function(){"use strict";angular.module("adbionic").factory("LocalService",function(){return{get:function(e){return localStorage.getItem(e)},set:function(e,t){return localStorage.setItem(e,t)},unset:function(e){return localStorage.removeItem(e)}}})}(),function(){"use strict";function e(e,t,n,i,a,o,r,c){function s(){var e=i.defer();return n.get(t+"/user/notifications/").success(function(t,n,i,a){if(e.resolve(t),!t.hasOwnProperty("err")){var o=[];t.forEach(function(e,t){e._loading=!1,e.action&&o.push(e)}),angular.copy(o,b.list)}}).error(function(t){setTimeout(function(){e.reject(t)},2e3)}),e.promise}function u(e){var a=i.defer();return n.put(t+"/user/notifications/"+e).success(function(e,t,n,i){setTimeout(function(){a.resolve(e)},2e3)}).error(function(e){setTimeout(function(){a.reject(e)},2e3)}),a.promise}function d(t,n){var i=e.findIndex(b.list,function(e){return e[n]==t});return i}function l(e,t){return t?a.reject({id:e.relatedRelationship}):a.accept({id:e.relatedRelationship})}function f(e,t){return console.log(e),t?r.rejectRequest({activity:e.relatedActivity,user:e.relatedRequester}):r.acceptRequest({activity:e.relatedActivity,user:e.relatedRequester})}function m(e){return console.log(e),o.acceptInvitation({room:e.relatedRoom})}function p(e,t){return console.log(e),t?r.rejectInvitation({activity:e.relatedActivity}):r.acceptInvitation({activity:e.relatedActivity})}function g(e,t){return console.log(e),a.fistBump({id:e.sender.id})}function v(e){var a=i.defer();return n.get(t+"/notifications/",e).success(function(e,t,n,i){a.resolve(e)}).error(function(e){setTimeout(function(){a.reject(e)},2e3)}),a.promise}function h(e){var a=i.defer();return n.put(t+"/notifications/",e).success(function(e,t,n,i){a.resolve(e)}).error(function(e){setTimeout(function(){a.reject(e)},2e3)}),a.promise}function y(e,t){return console.log(e,t),t?c.rejectRequest({invitation:e.relatedParentalInvitation}):c.acceptRequest({invitation:e.relatedParentalInvitation})}var b={get:s,config:v,saveConfig:h,update:u,find:d,list:[],settings:[],acceptInvitation:l,acceptInvitationToActivity:p,acceptInvitationToGroup:m,fistBumpBack:g,acceptRequestingInvitation:f,acceptParentalControlInvitation:y};return b}angular.module("adbionic").factory("NotificationService",e),e.$inject=["_","BaseApiUrl","$http","$q","FriendshipService","GroupService","ActivityService","ParentalService"]}(),function(){"use strict";function e(e,t,n,i,a,o){function r(t){var n=a.defer();return i.put(e+"/parental/"+t.invitation+"/accept").success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function c(t){var n=a.defer();return i.put(e+"/parental/"+t.invitation+"/reject").success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}var s={acceptRequest:r,rejectRequest:c};return s}angular.module("adbionic").factory("ParentalService",e),e.$inject=["BaseApiUrl","_","moment","$http","$q","$rootScope"]}(),function(){"use strict";function e(e,t,n,i){function a(){n.sails.autoConnect=!1,
d.connection=n.sails.connect(e,{forceNew:!0}),o()}function o(){d.connection.on("connect",function(e,t){d.subscribed||d.subscribe("/user/subscribe/").then(function(e){d.subscribed=!0})}),d.connection.on("disconnect",function(e,t){console.log("disconnected to socket service"),console.log(e,t),d.subscribed=!1}),d.connection.on("reconnecting",function(e){console.log("reconnecting to socket service")})}function r(){console.log("disconnecting");var e=i.defer();t.get("access_token");return d.get("/user/unsubscribe/").then(function(t){console.log("unsubscribed to",t),e.resolve(t)}),e.promise}function c(n){var a=i.defer(),o=t.get("access_token");return d.connection.get(e+n+"?token="+o,null,function(e){a.resolve(e)}),a.promise}function s(n,a){var o=i.defer(),r=t.get("access_token");return d.connection.get(e+n+"?token="+r,a,function(e){o.resolve(e)}),o.promise}function u(e,n,i,a){var o=t.get("access_token");d.connection.request({method:e,url:n,headers:{Authorization:"Bearer "+o}},a)}var d={init:a,connection:null,disconnect:r,subscribe:c,handle:o,subscribed:!1,get:s,request:u};return d}angular.module("adbionic").factory("SocketService",e),e.$inject=["BaseApiUrl","LocalService","io","$q"]}(),function(){"use strict";function e(e,t,n,i,a,o,r){function c(e,n){var i=a.defer(),r="/user/"+e;return n&&(r="/account/"+n),o.get(t+r).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise}function s(e){var n=a.defer();return o.get(t+"/user/"+e+"/activities/").success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function u(e){var n=a.defer();return o.get(t+"/user/"+e+"/buddies/").success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function d(){return r.user.lastLogin=e().format(),l(r.user.id,r.user)}function l(e,i){var c=a.defer(),s=t+"/user/"+e;return o.put(s,i).success(function(e,t,i,a){c.resolve(e),angular.copy(e,r.user),n.set("user",JSON.stringify(e))}).error(function(e){c.reject(e)}),c.promise}function f(e){var i=a.defer(),c=t+"/user/status";return o.put(c,e).success(function(e,t,a,o){i.resolve(e),angular.copy(e,r.user),n.set("user",JSON.stringify(e))}).error(function(e){i.reject(e)}),i.promise}function m(e){var n=a.defer();return o.get(t+"/user/control/"+e).success(function(e,t,i,a){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function p(e){var n=a.defer(),i=t+"/auth/changePassword";return o.post(i,e).success(function(e,t,i,a){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function g(){var e=a.defer(),n=t+"/user/resume/";return o.get(n).success(function(t,n,i,a){e.resolve(t)}).error(function(t){e.reject(t)}),e.promise}function v(e){var n=a.defer(),i=t+"/user/notifications/";return o.put(i,e).success(function(e,t,i,a){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function h(){var e=a.defer(),n=t+"/auth/validationEmail/";return o.post(n).success(function(t,n,i,a){e.resolve(t)}).error(function(t){e.reject(t)}),e.promise}function y(){var e=a.defer(),n=t+"/user/blocked/";return o.get(n).success(function(t,n,i,a){e.resolve(t)}).error(function(t){e.reject(t)}),e.promise}function b(e){var n=a.defer(),i=t+"/user/unblock/"+e.user;return o.post(i).success(function(e,t,i,a){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}function _(){var e=a.defer(),n=t+"/user/parental/";return o.get(n).success(function(t,n,i,a){e.resolve(t)}).error(function(t){e.reject(t)}),e.promise}function S(e){var n=a.defer(),i=t+"/parental/";return o.post(i,e).success(function(e,t,i,a){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise}var w={detail:c,update:l,resume:g,status:f,buddies:u,blocked:y,unblock:b,setLogin:d,activities:s,changeUser:m,changePassword:p,readNotifications:v,resendVerification:h,listParental:_,sendRequestParental:S};return w}angular.module("adbionic").factory("UserService",e),e.$inject=["moment","BaseApiUrl","LocalService","SocketService","$q","$http","$rootScope"]}(),function(){"use strict";function e(e,t,n,i,a,o,r){function c(e){for(var t=[],n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length,a=0;e>a;++a)t.push(n[u(0,i-1)]);return t.join("")}function s(e){var t=$mdToast.simple().textContent(e).action("OK").highlightAction(!1).position("top right");$mdToast.show(t)}function u(e,t){return Math.floor(Math.random()*(t-e+1))+e}function d(){var t=i.defer();return n.get(e+"/badwords/").success(function(e){angular.copy(e.words.map(function(e){return e.toLowerCase()}),h.words),t.resolve(e)}).error(function(e){t.reject(e)}),t.promise}function l(){var a=i.defer();return n.get(e+"/settings/"+t).success(function(e){a.resolve(e),angular.copy(e.settings,h.settings)}).error(function(e){a.reject(e)}),a.promise}function f(){var e=i.defer();return o.ready(function(){r.getCurrentPosition({timeout:1e4,enableHighAccuracy:!1}).then(function(t){e.resolve({lat:t.coords.latitude,lng:t.coords.longitude})})}),e.promise}function m(){return a.navigator.language.substring(0,2)}function p(){return[{name:"Social",value:"social"},{name:"Active",value:"active"},{name:"Services",value:"handy"}]}function g(e){var t=function(e,n){return _.isObject(e)?_.merge({},e,n,t):e||n},n=_.flatten([{},e,t]);return _.merge.apply(_,n)}function v(){return[{name:"Afghanistan",id:"AF"},{name:"land Islands",id:"AX"},{name:"Albania",id:"AL"},{name:"Algeria",id:"DZ"},{name:"American Samoa",id:"AS"},{name:"AndorrA",id:"AD"},{name:"Angola",id:"AO"},{name:"Anguilla",id:"AI"},{name:"Antarctica",id:"AQ"},{name:"Antigua and Barbuda",id:"AG"},{name:"Argentina",id:"AR"},{name:"Armenia",id:"AM"},{name:"Aruba",id:"AW"},{name:"Australia",id:"AU"},{name:"Austria",id:"AT"},{name:"Azerbaijan",id:"AZ"},{name:"Bahamas",id:"BS"},{name:"Bahrain",id:"BH"},{name:"Bangladesh",id:"BD"},{name:"Barbados",id:"BB"},{name:"Belarus",id:"BY"},{name:"Belgium",id:"BE"},{name:"Belize",id:"BZ"},{name:"Benin",id:"BJ"},{name:"Bermuda",id:"BM"},{name:"Bhutan",id:"BT"},{name:"Bolivia",id:"BO"},{name:"Bosnia and Herzegovina",id:"BA"},{name:"Botswana",id:"BW"},{name:"Bouvet Island",id:"BV"},{name:"Brazil",id:"BR"},{name:"British Indian Ocean Territory",id:"IO"},{name:"Brunei Darussalam",id:"BN"},{name:"Bulgaria",id:"BG"},{name:"Burkina Faso",id:"BF"},{name:"Burundi",id:"BI"},{name:"Cambodia",id:"KH"},{name:"Cameroon",id:"CM"},{name:"Canada",id:"CA"},{name:"Cape Verde",id:"CV"},{name:"Cayman Islands",id:"KY"},{name:"Central African Republic",id:"CF"},{name:"Chad",id:"TD"},{name:"Chile",id:"CL"},{name:"China",id:"CN"},{name:"Christmas Island",id:"CX"},{name:"Cocos (Keeling) Islands",id:"CC"},{name:"Colombia",id:"CO"},{name:"Comoros",id:"KM"},{name:"Congo",id:"CG"},{name:"Congo, The Democratic Republic of the",id:"CD"},{name:"Cook Islands",id:"CK"},{name:"Costa Rica",id:"CR"},{name:"Cote D'Ivoire",id:"CI"},{name:"Croatia",id:"HR"},{name:"Cuba",id:"CU"},{name:"Cyprus",id:"CY"},{name:"Czech Republic",id:"CZ"},{name:"Denmark",id:"DK"},{name:"Djibouti",id:"DJ"},{name:"Dominica",id:"DM"},{name:"Dominican Republic",id:"DO"},{name:"Ecuador",id:"EC"},{name:"Egypt",id:"EG"},{name:"El Salvador",id:"SV"},{name:"Equatorial Guinea",id:"GQ"},{name:"Eritrea",id:"ER"},{name:"Estonia",id:"EE"},{name:"Ethiopia",id:"ET"},{name:"Falkland Islands (Malvinas)",id:"FK"},{name:"Faroe Islands",id:"FO"},{name:"Fiji",id:"FJ"},{name:"Finland",id:"FI"},{name:"France",id:"FR"},{name:"French Guiana",id:"GF"},{name:"French Polynesia",id:"PF"},{name:"French Southern Territories",id:"TF"},{name:"Gabon",id:"GA"},{name:"Gambia",id:"GM"},{name:"Georgia",id:"GE"},{name:"Germany",id:"DE"},{name:"Ghana",id:"GH"},{name:"Gibraltar",id:"GI"},{name:"Greece",id:"GR"},{name:"Greenland",id:"GL"},{name:"Grenada",id:"GD"},{name:"Guadeloupe",id:"GP"},{name:"Guam",id:"GU"},{name:"Guatemala",id:"GT"},{name:"Guernsey",id:"GG"},{name:"Guinea",id:"GN"},{name:"Guinea-Bissau",id:"GW"},{name:"Guyana",id:"GY"},{name:"Haiti",id:"HT"},{name:"Heard Island and Mcdonald Islands",id:"HM"},{name:"Holy See (Vatican City State)",id:"VA"},{name:"Honduras",id:"HN"},{name:"Hong Kong",id:"HK"},{name:"Hungary",id:"HU"},{name:"Iceland",id:"IS"},{name:"India",id:"IN"},{name:"Indonesia",id:"ID"},{name:"Iran, Islamic Republic Of",id:"IR"},{name:"Iraq",id:"IQ"},{name:"Ireland",id:"IE"},{name:"Isle of Man",id:"IM"},{name:"Israel",id:"IL"},{name:"Italy",id:"IT"},{name:"Jamaica",id:"JM"},{name:"Japan",id:"JP"},{name:"Jersey",id:"JE"},{name:"Jordan",id:"JO"},{name:"Kazakhstan",id:"KZ"},{name:"Kenya",id:"KE"},{name:"Kiribati",id:"KI"},{name:"Korea, Democratic People'S Republic of",id:"KP"},{name:"Korea, Republic of",id:"KR"},{name:"Kuwait",id:"KW"},{name:"Kyrgyzstan",id:"KG"},{name:"Lao People'S Democratic Republic",id:"LA"},{name:"Latvia",id:"LV"},{name:"Lebanon",id:"LB"},{name:"Lesotho",id:"LS"},{name:"Liberia",id:"LR"},{name:"Libyan Arab Jamahiriya",id:"LY"},{name:"Liechtenstein",id:"LI"},{name:"Lithuania",id:"LT"},{name:"Luxembourg",id:"LU"},{name:"Macao",id:"MO"},{name:"Macedonia, The Former Yugoslav Republic of",id:"MK"},{name:"Madagascar",id:"MG"},{name:"Malawi",id:"MW"},{name:"Malaysia",id:"MY"},{name:"Maldives",id:"MV"},{name:"Mali",id:"ML"},{name:"Malta",id:"MT"},{name:"Marshall Islands",id:"MH"},{name:"Martinique",id:"MQ"},{name:"Mauritania",id:"MR"},{name:"Mauritius",id:"MU"},{name:"Mayotte",id:"YT"},{name:"Mexico",id:"MX"},{name:"Micronesia, Federated States of",id:"FM"},{name:"Moldova, Republic of",id:"MD"},{name:"Monaco",id:"MC"},{name:"Mongolia",id:"MN"},{name:"Montserrat",id:"MS"},{name:"Morocco",id:"MA"},{name:"Mozambique",id:"MZ"},{name:"Myanmar",id:"MM"},{name:"Namibia",id:"NA"},{name:"Nauru",id:"NR"},{name:"Nepal",id:"NP"},{name:"Netherlands",id:"NL"},{name:"Netherlands Antilles",id:"AN"},{name:"New Caledonia",id:"NC"},{name:"New Zealand",id:"NZ"},{name:"Nicaragua",id:"NI"},{name:"Niger",id:"NE"},{name:"Nigeria",id:"NG"},{name:"Niue",id:"NU"},{name:"Norfolk Island",id:"NF"},{name:"Northern Mariana Islands",id:"MP"},{name:"Norway",id:"NO"},{name:"Oman",id:"OM"},{name:"Pakistan",id:"PK"},{name:"Palau",id:"PW"},{name:"Palestinian Territory, Occupied",id:"PS"},{name:"Panama",id:"PA"},{name:"Papua New Guinea",id:"PG"},{name:"Paraguay",id:"PY"},{name:"Peru",id:"PE"},{name:"Philippines",id:"PH"},{name:"Pitcairn",id:"PN"},{name:"Poland",id:"PL"},{name:"Portugal",id:"PT"},{name:"Puerto Rico",id:"PR"},{name:"Qatar",id:"QA"},{name:"Reunion",id:"RE"},{name:"Romania",id:"RO"},{name:"Russian Federation",id:"RU"},{name:"RWANDA",id:"RW"},{name:"Saint Helena",id:"SH"},{name:"Saint Kitts and Nevis",id:"KN"},{name:"Saint Lucia",id:"LC"},{name:"Saint Pierre and Miquelon",id:"PM"},{name:"Saint Vincent and the Grenadines",id:"VC"},{name:"Samoa",id:"WS"},{name:"San Marino",id:"SM"},{name:"Sao Tome and Principe",id:"ST"},{name:"Saudi Arabia",id:"SA"},{name:"Senegal",id:"SN"},{name:"Serbia and Montenegro",id:"CS"},{name:"Seychelles",id:"SC"},{name:"Sierra Leone",id:"SL"},{name:"Singapore",id:"SG"},{name:"Slovakia",id:"SK"},{name:"Slovenia",id:"SI"},{name:"Solomon Islands",id:"SB"},{name:"Somalia",id:"SO"},{name:"South Africa",id:"ZA"},{name:"South Georgia and the South Sandwich Islands",id:"GS"},{name:"Spain",id:"ES"},{name:"Sri Lanka",id:"LK"},{name:"Sudan",id:"SD"},{name:"Suriname",id:"SR"},{name:"Svalbard and Jan Mayen",id:"SJ"},{name:"Swaziland",id:"SZ"},{name:"Sweden",id:"SE"},{name:"Switzerland",id:"CH"},{name:"Syrian Arab Republic",id:"SY"},{name:"Taiwan, Province of China",id:"TW"},{name:"Tajikistan",id:"TJ"},{name:"Tanzania, United Republic of",id:"TZ"},{name:"Thailand",id:"TH"},{name:"Timor-Leste",id:"TL"},{name:"Togo",id:"TG"},{name:"Tokelau",id:"TK"},{name:"Tonga",id:"TO"},{name:"Trinidad and Tobago",id:"TT"},{name:"Tunisia",id:"TN"},{name:"Turkey",id:"TR"},{name:"Turkmenistan",id:"TM"},{name:"Turks and Caicos Islands",id:"TC"},{name:"Tuvalu",id:"TV"},{name:"Uganda",id:"UG"},{name:"Ukraine",id:"UA"},{name:"United Arab Emirates",id:"AE"},{name:"United Kingdom",id:"GB"},{name:"United States",id:"US"},{name:"United States Minor Outlying Islands",id:"UM"},{name:"Uruguay",id:"UY"},{name:"Uzbekistan",id:"UZ"},{name:"Vanuatu",id:"VU"},{name:"Venezuela",id:"VE"},{name:"Viet Nam",id:"VN"},{name:"Virgin Islands, British",id:"VG"},{name:"Virgin Islands, U.S.",id:"VI"},{name:"Wallis and Futuna",id:"WF"},{name:"Western Sahara",id:"EH"},{name:"Yemen",id:"YE"},{name:"Zambia",id:"ZM"},{name:"Zimbabwe",id:"ZW"}]}var h={words:[],settings:{maxDaysToActivateAccount:7},locale:m(),defaultAvatar:"http://res.cloudinary.com/dy14eiv7n/image/upload/v1458829528/default_avatar.png",uid:c,showToast:s,getBadWords:d,getSettings:l,getLocation:f,getCountries:v,getCategories:p,mergeObjects:g};return h}angular.module("adbionic").factory("UtilService",e),e.$inject=["BaseApiUrl","version","$http","$q","$window","$ionicPlatform","$cordovaGeolocation"]}();